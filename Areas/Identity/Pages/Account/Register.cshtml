@page
@model RegisterModel
@{
    ViewData["Title"] = "Register";
}

@using Microsoft.Extensions.Options
@inject IOptions<GoogleCaptchaConfig> GoogleCaptchaConfig

<div class="flex w-full" x-data="{ open: false }">


    <div x-show="open" @@click.away="open = false" 2@keydown.escape.window="open = false"
        class="fixed inset-0 flex items-center justify-center bg-gray-800 bg-opacity-50 z-50"
        x-transition:enter="ease-out duration-300" x-transition:enter-start="opacity-0 scale-95"
        x-transition:enter-end="opacity-100 scale-100" x-transition:leave="ease-in duration-200"
        x-transition:leave-start="opacity-100 scale-100" x-transition:leave-end="opacity-0 scale-95"
        style="display: none;">

        <div
            class="bg-neutral-200/20 top-to-bottom mx-4 flex w-full flex-col rounded-lg p-6 text-neutral-950 shadow-lg backdrop-blur-sm">
            <p class="mb-4 text-2xl">Rules</p>
            <p>
                Lorem ipsum dolor sit amet consectetur adipisicing elit. Aliquam consequatur ratione necessitatibus
                neque aliquid quaerat provident omnis, magnam labore consectetur?
            </p>
            <button @@click="open = false" class="py-2 px-4 bg-neutral-200/50 backdrop-blur-sm shadow-lg mt-4 rounded-lg text-red-500">
                Close
            </button>
        </div>
    </div>


    <div class="left-to-right hidden lg:flex h-dvh w-1/2 items-center justify-center p-1">
        <div
            class="bg-[url('../images/black-and-white-leaf-810vk4fpm5babnuc.webp')] flex flex-col justify-end gap-4 p-10 rounded-xl bg-center bg-no-repeat bg-cover w-full h-full">
            <div
                class="bg-neutral-200/20 top-to-bottom !animation-delay-1000 flex w-full flex-col rounded-lg p-6 text-neutral-950 shadow-lg backdrop-blur-sm">
                <p class="mb-4 text-2xl">Rules</p>
                <p>
                    Lorem ipsum dolor sit amet consectetur adipisicing elit. Aliquam consequatur ratione necessitatibus
                    neque aliquid quaerat provident omnis, magnam labore consectetur?
                </p>
            </div>
            <div
                class="bg-neutral-200/20 top-to-bottom !animation-delay-900 flex w-full flex-col rounded-lg p-6 text-neutral-950 shadow-lg backdrop-blur-sm">
                <p class="mb-4 text-2xl">About us</p>
                <p>
                    Lorem ipsum dolor sit amet consectetur adipisicing elit. Aliquam consequatur ratione necessitatibus
                    neque aliquid quaerat provident omnis, magnam labore consectetur?
                </p>
            </div>
        </div>
    </div>
    <div class="right-to-left flex w-full lg:w-1/2 items-center justify-center">
        <div
            class="w-full sm:w-[30rem] h-dvh sm:h-auto sm:rounded-xl bg-neutral-300 px-8 sm:px-14 py-4 sm:py-8 shadow-xl">
            <h1 class="bottom-to-top !animation-delay-500 mb-14 select-none text-5xl text-neutral-700">
                @ViewData["Title"]
            </h1>
            <form method="post">
                <input hidden id="LoginViewModelToken" asp-for="Input.Token">
                <div class="flex flex-col gap-3">
                    <input asp-for="Input.Username"
                        class="bottom-to-top !animation-delay-500 w-full rounded-lg bg-white px-4 py-2 text-center text-neutral-900 shadow-lg outline-none"
                        autocomplete="off" placeholder="Username" />
                    <span asp-validation-for="Input.Username" class="-mt-3 ml-2 text-sm text-red-700"></span>
                    <div class="bottom-to-top !animation-delay-500 relative">
                        <input asp-for="Input.Password"
                            class="w-full rounded-lg bg-white px-4 py-2 text-center text-neutral-900 shadow-lg outline-none"
                            autocomplete="off" placeholder="Password" id="password-input" type="password" />
                        <button type="button"
                            class="absolute bottom-0 right-0 top-0 flex w-10 items-center justify-center rounded-e-lg bg-transparent hover:backdrop-brightness-75"
                            tabindex="-1" data-target="password-input" onclick="togglePasswordVisibility(this)">
                            <i class="bi bi-eye-fill"></i>
                        </button>
                    </div>
                    <span asp-validation-for="Input.Password" class="-mt-3 ml-2 text-sm text-red-700"></span>
                    <div class="bottom-to-top !animation-delay-500 relative">
                        <input asp-for="Input.ConfirmPassword"
                            class="w-full rounded-lg bg-white px-4 py-2 text-center text-neutral-900 shadow-lg outline-none"
                            autocomplete="off" placeholder="Confirm Password" id="confirm-password-input"
                            type="password" />
                        <button type="button"
                            class="absolute bottom-0 right-0 top-0 flex w-10 items-center justify-center rounded-e-lg bg-transparent hover:backdrop-brightness-75"
                            tabindex="-1" data-target="confirm-password-input" onclick="togglePasswordVisibility(this)">
                            <i class="bi bi-eye-fill"></i>
                        </button>
                    </div>
                    <span asp-validation-for="Input.ConfirmPassword" class="-mt-3 ml-2 text-sm text-red-700"></span>
                    <input asp-for="Input.Email"
                        class="bottom-to-top !animation-delay-500 w-full rounded-lg bg-white px-4 py-2 text-center text-neutral-900 shadow-lg outline-none"
                        autocomplete="off" placeholder="Email" />
                    <span asp-validation-for="Input.Email" class="-mt-3 ml-2 text-sm text-red-700"></span>
                    <div class="bottom-to-top !animation-delay-500 relative">
                        <input asp-for="Input.Address"
                            class="w-full rounded-lg bg-white px-4 py-2 text-center text-neutral-900 shadow-lg outline-none"
                            autocomplete="off" placeholder="Address" />
                        <button type="button"
                            class="absolute bottom-0 right-0 top-0 flex w-10 items-center justify-center rounded-e-lg bg-transparent hover:backdrop-brightness-75"
                            tabindex="-1">
                            <i class="bi bi-geo-alt-fill"></i>
                        </button>
                    </div>
                    <span asp-validation-for="Input.Address" class="-mt-3 ml-2 text-sm text-red-700"></span>
                    <div class="bottom-to-top !animation-delay-500 mb-8 inline-flex items-center justify-between">
                        <div class="inline-flex items-center">
                            <label class="relative flex cursor-pointer items-center" for="check-2">
                                <input type="checkbox"
                                    class="border-2 peer h-5 w-5 appearance-none rounded-md border-neutral-800 bg-neutral-300 shadow checked:bg-neutral-800 hover:shadow-md"
                                    id="check-2" tabindex="-1" asp-for="Input.AcceptRules" />
                                <span
                                    class="opacity-0 -translate-x-1/2 -translate-y-1/2 absolute left-1/2 top-1/2 transform text-white peer-checked:opacity-100">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5" viewBox="0 0 20 20"
                                        fill="currentColor" stroke="currentColor" stroke-width="1">
                                        <path fill-rule="evenodd"
                                            d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                                            clip-rule="evenodd"></path>
                                    </svg>
                                </span>
                            </label>
                            <label class="ml-2 cursor-pointer select-none text-sm text-neutral-800" for="check-2">
                                I accept the rules
                            </label>
                        </div>
                        <button @@click="open = true" type="button"
                            class="text-blue-500 hover:text-blue-700 text-sm lg:hidden">Rules</button>
                    </div>
                    <button type="submit" id="registerButton"
                        class="bottom-to-top !animation-delay-500 w-full rounded-lg bg-white px-4 py-2 text-lg shadow-lg">
                        Register
                    </button>
                    <div class="bottom-to-top !animation-delay-500">
                        <p class="text-center">
                            Do you have an account?
                            <a asp-page="./Login" class="text-blue-500 hover:text-blue-700" tabindex="-1"
                                asp-route-returnUrl="@Model.ReturnUrl">Login</a>
                        </p>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {

    <script>
        function togglePasswordVisibility(button) {
            const inputId = button.getAttribute("data-target");
            const passwordInput = document.getElementById(inputId);
            const toggleIcon = button.querySelector("i");

            if (passwordInput.type === "password") {
                passwordInput.type = "text";
                toggleIcon.classList.remove("bi-eye-fill");
                toggleIcon.classList.add("bi-eye-slash-fill");
            } else {
                passwordInput.type = "password";
                toggleIcon.classList.remove("bi-eye-slash-fill");
                toggleIcon.classList.add("bi-eye-fill");
            }
        }
    </script>

    <script src="https://www.google.com/recaptcha/api.js?render=@GoogleCaptchaConfig.Value.SiteKey"></script>
    <script>
        function onClick(e) {
            e.preventDefault();

            grecaptcha.ready(function () {
                grecaptcha.execute('@GoogleCaptchaConfig.Value.SiteKey', { action: 'submit' }).then(function (token) {

                    document.getElementById("LoginViewModelToken").value = token;

                    document.querySelector('form').submit();
                });
            });
        }

        document.getElementById('registerButton').addEventListener('click', onClick);
    </script>

    <partial name="_ValidationScriptsPartial" />
}
